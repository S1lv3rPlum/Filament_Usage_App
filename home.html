<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filament Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <!-- <link rel="manifest" href="/manifest.json" /> -->
  <meta name="theme-color" content="#007acc" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
  <h1>Filament Foundry</h1>
  <p id="companyNameDisplay" style="font-size: 1em; margin-top: 5px; opacity: 0.95; font-weight: 600;"></p>
  <!-- Workspace Switcher -->
<div id="workspaceSwitcher" style="text-align: center; margin: 10px 0; padding: 10px; background: #f0f4f8; border-radius: 8px;">
  <div style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
    <span style="font-weight: 500; color: #666;">Workspace:</span>
    <select id="workspaceSelect" onchange="switchWorkspace()" style="padding: 8px 12px; font-size: 1em; border-radius: 6px; border: 2px solid #007acc; background: white; cursor: pointer;">
      <option value="personal">ğŸ‘¤ Personal</option>
    </select>
    <button onclick="showCreateOrganizationModal()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
      â• Create Business
    </button>
    <button onclick="showJoinOrganizationModal()" style="padding: 8px 16px; background: #007acc; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
      ğŸ”— Join Business
    </button>
  </div>
  <div id="workspaceInfo" style="margin-top: 8px; font-size: 0.85em; color: #666;"></div>
</div>
</header>

<main id="home">
  <!-- Low Filament Alert Badge -->
  <div id="lowFilamentBadge" class="hidden" style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center;">
    <span style="font-size: 1.1em; font-weight: bold; color: #856404;">
      âš ï¸ <span id="lowFilamentCount">0</span> spool(s) running low on filament
    </span>
    <br>
    <small style="color: #666;">Check your inventory to see which spools need attention</small>
  </div>
  
  <button onclick="showScreen('tracking')">ğŸ¯ Start Tracking</button>
  <button onclick="showScreen('addSpool')">â• Add New Spool</button>
  <button onclick="window.location.href='inventory.html'">ğŸ“¦ View Inventory</button>
  <button onclick="showScreen('materials')">ğŸ“‹ Manage Materials</button>
  <button onclick="window.location.href='emptyspools.html'">ğŸ§µ Empty Spool Weights</button>
  <button onclick="showScreen('history')">ğŸ“œ Usage History</button>
  <button onclick="showScreen('analytics')">ğŸ“Š Analytics</button>
  <button onclick="showScreen('settings')">âš™ï¸ Settings</button>
</main>

<section id="addSpool" class="hidden">
  <h2>Add New Spool</h2>
  
  <input id="brand" placeholder="Brand" />
  <input id="color" placeholder="Color Name" />
  
  <select id="materialSelect" onchange="handleMaterialChange()" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
    <!-- Options inserted dynamically -->
  </select>
  
 
  <input id="length" type="number" placeholder="Length (m) - Optional" />

 <!-- Color Details Section -->
<div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
  <h3 style="margin-top: 0; font-size: 1.1em;">Color Details</h3>
  
  <label for="colorType" style="display: block; margin-top: 10px; font-weight: bold;">Color Type:</label>
  <select id="colorType" onchange="handleColorTypeChange()" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
    <option value="solid">Solid</option>
    <option value="gradient">Gradient</option>
  </select>
  
  <!-- Solid Color Fields -->
  <div id="solidColorFields" style="margin-top: 10px;">
    <label for="baseColorSolid" style="display: block; margin-top: 10px; font-weight: bold;">Base Color:</label>
    <select id="baseColorSolid" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
      <option value="">Select...</option>
      <option value="Red">Red</option>
      <option value="Orange">Orange</option>
      <option value="Yellow">Yellow</option>
      <option value="Green">Green</option>
      <option value="Blue">Blue</option>
      <option value="Purple">Purple</option>
      <option value="Pink">Pink</option>
      <option value="Brown">Brown</option>
      <option value="Black">Black</option>
      <option value="White">White</option>
      <option value="Gray">Gray</option>
      <option value="Clear/Natural">Clear/Natural</option>
      <option value="Multicolor">Multicolor</option>
      <option value="Other">Other</option>
    </select>
  </div>
  
  <!-- Gradient Color Fields -->
  <div id="gradientColorFields" class="hidden" style="margin-top: 10px;">
    <label style="display: block; margin-top: 10px; font-weight: bold;">Base Colors in Gradient (select up to 3):</label>
    <div class="checkbox-table">
  <div class="checkbox-row">
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Red" style="margin-right: 8px;" />
        <span>Red</span>
      </label>
    </div>
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Orange" style="margin-right: 8px;" />
        <span>Orange</span>
      </label>
    </div>
  </div>
  <div class="checkbox-row">
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Yellow" style="margin-right: 8px;" />
        <span>Yellow</span>
      </label>
    </div>
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Green" style="margin-right: 8px;" />
        <span>Green</span>
      </label>
    </div>
  </div>
  <div class="checkbox-row">
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Blue" style="margin-right: 8px;" />
        <span>Blue</span>
      </label>
    </div>
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Purple" style="margin-right: 8px;" />
        <span>Purple</span>
      </label>
    </div>
  </div>
  <div class="checkbox-row">
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Pink" style="margin-right: 8px;" />
        <span>Pink</span>
      </label>
    </div>
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Brown" style="margin-right: 8px;" />
        <span>Brown</span>
      </label>
    </div>
  </div>
  <div class="checkbox-row">
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Black" style="margin-right: 8px;" />
        <span>Black</span>
      </label>
    </div>
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="White" style="margin-right: 8px;" />
        <span>White</span>
      </label>
    </div>
  </div>
  <div class="checkbox-row">
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Gray" style="margin-right: 8px;" />
        <span>Gray</span>
      </label>
    </div>
    <div class="checkbox-cell">
      <label class="checkbox-label">
        <input type="checkbox" name="gradientColors" value="Rainbow" style="margin-right: 8px;" />
        <span>Rainbow</span>
      </label>
    </div>
  </div>
</div>
  </div>
  
  <label for="sheen" style="display: block; margin-top: 10px; font-weight: bold;">Sheen:</label>
  <select id="sheen" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
    <option value="">Select...</option>
    <option value="matte">Matte</option>
    <option value="glossy">Glossy</option>
    <option value="silk">Silk</option>
    <option value="glitter">Glitter</option>
    <option value="metallic">Metallic</option>
    <option value="satin">Satin</option>
  </select>
  
  <label for="glowInDark" style="display: block; margin-top: 10px; font-weight: bold;">Glow in the Dark:</label>
  <div style="display: flex; justify-content: center; gap: 20px; margin-top: 5px;">
    <label style="display: flex; align-items: center; cursor: pointer;">
      <input type="radio" name="glowInDark" value="no" checked style="margin-right: 5px;" />
      No
    </label>
    <label style="display: flex; align-items: center; cursor: pointer;">
      <input type="radio" name="glowInDark" value="yes" style="margin-right: 5px;" />
      Yes
    </label>
  </div>
  
  <label for="texture" style="display: block; margin-top: 10px; font-weight: bold;">Texture:</label>
  <select id="texture" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
    <option value="">Select...</option>
    <option value="smooth">Smooth</option>
    <option value="textured">Textured</option>
    <option value="wood-grain">Wood Grain</option>
    <option value="marble">Marble</option>
    <option value="carbon-fiber">Carbon Fiber</option>
    <option value="fuzzy">Fuzzy</option>
  </select>
</div>

  <!-- Spool Weight Section -->
  <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
    <h3 style="margin-top: 0; font-size: 1.1em;">Spool Weight Information</h3>
    
    <label for="emptySpoolSelect" style="display: block; margin-top: 10px; font-weight: bold;">Empty Spool:</label>
    <select id="emptySpoolSelect" onchange="handleEmptySpoolSelection()"></select>

    <input 
      id="fullSpoolWeight" 
      type="number" 
      step="0.01" 
      placeholder="Full spool weight (including empty spool) (g)" 
      oninput="calculateFilamentAmount()"
      style="margin-top: 10px;"
    />

    <div id="filamentAmountDisplay" style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px; display: none;">
      <strong>Calculated Filament Amount:</strong>
      <div style="font-size: 1.3em; color: #007acc; font-weight: bold; margin-top: 5px;" id="filamentAmount">0g</div>
    </div>
  </div>
  
  <div class="button-container">
    <button onclick="saveSpool()">Save Spool</button>
    <button type="button" onclick="window.location.href='emptyspools.html'">Manage Empty Spools</button>
    <button onclick="showScreen('home')">â¬… Back</button>
  </div>
</section>

<!-- Inventory Screen -->
<section id="library" class="hidden">
  <h2>Spool Library</h2>
  <ul id="spoolList"></ul>
  <button onclick="showScreen('home')">â¬… Back</button>
</section>

<section id="history" class="hidden">
  <h2>Usage History</h2>

  <div id="historyFilters" style="margin-bottom: 15px;">
    <label>
      Start Date:
      <input type="date" id="filterStartDate" />
    </label>

    <label style="margin-left: 10px;">
      End Date:
      <input type="date" id="filterEndDate" />
    </label>

    <label style="margin-left: 10px;">
      Spool:
      <select id="filterSpool">
        <option value="">All Spools</option>
        <!-- Options populated dynamically -->
      </select>
    </label>

    <button id="filterButton" style="margin-left: 10px;">Filter</button>
    <button id="clearFilterButton" style="margin-left: 5px;">Clear</button>
  </div>

  <ul id="historyList"></ul>
  <button onclick="showScreen('home')">â¬… Back</button>
</section>

<!-- Tracking / Print Jobs Screen -->
<section id="tracking" class="hidden">
  <h2>Print Job Tracking</h2>

  <!-- Start Print Form -->
  <section id="startPrintSection">
    <h2>Start Print Job</h2>
    <input id="jobName" placeholder="Enter print job name (optional)" />
    <label for="selectSpools">Select Spools (multi-select):</label>
    <select id="selectSpools" multiple size="5" style="width: 100%;"></select>
    
    <!-- NEW: Estimated weight fields will appear here per spool -->
    <div id="estimatedWeightsContainer"></div>
    
    <div class="button-container">
      <button onclick="startPrintJob()">Start Print</button>
      <button onclick="showScreen('home')">â¬… Back</button>
    </div>
  </section>

  <section id="endPrintSection" class="hidden">
    <h3 id="activeJobName"></h3>
    <div id="endWeightsContainer"></div>
    
    <div class="button-container">
      <button onclick="endPrintJob()">âœ… End Print (Success)</button>
      <button onclick="failedPrintJob()" style="background: #ff6b6b;">âŒ Failed Print</button>
      <button onclick="cancelActiveJob()">Cancel Job</button>
      <button onclick="showScreen('home')">â¬… Back</button>
    </div>
  </section>
</section>

<!-- Analytics screen -->
<section id="analytics" class="hidden" style="height:400px; position:relative;">
  <h2>Analytics</h2>
  <canvas id="usageChart"></canvas>
  <button onclick="showScreen('home')">â¬… Back</button>
</section>

<!-- Materials Management Screen -->
<section id="materials" class="hidden">
  <h2>Manage Material Types</h2>
  
  <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
    <ul id="materialsList" style="list-style: none; padding: 0;"></ul>
    
    <div style="margin-top: 15px;">
      <input id="newMaterialInput" placeholder="Add new material type" style="width: 70%; display: inline-block;" />
      <button onclick="addNewMaterial()" style="width: 25%; display: inline-block; margin-left: 3%;">Add</button>
    </div>
  </div>
  
  <button onclick="showScreen('home')">â¬… Back</button>
</section>

<!-- Settings Screen -->
<section id="settings" class="hidden">
  <h2>Settings</h2>
  
  <!-- Upgrade Banner -->
  <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; text-align: center;">
    <h3 style="margin: 0 0 10px 0; font-size: 1.4em;">ğŸš€ Upgrade to Pro</h3>
    <p style="margin: 0 0 15px 0; opacity: 0.95;">Unlimited spools, advanced analytics, team collaboration & more!</p>
    <button onclick="alert('Subscription options coming soon! ğŸ‰')" style="background: white; color: #667eea; font-weight: bold;">Coming Soon!</button>
  </div>

  <!-- Usage Stats -->
  <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
    <h3>Account Usage</h3>
    <p><strong>Account Type:</strong> Free Tier</p>
    <p id="spoolCount"><strong>Spools:</strong> 0 / 25</p>
    <p><strong>Print History:</strong> Last 50 jobs saved</p>
  </div>

  <!-- Company Branding -->
  <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
    <h3>Company Branding</h3>
    <label for="companyName" style="display: block; margin-top: 10px; font-weight: bold;">Your Company Name (Optional):</label>
    <input 
      id="companyName" 
      type="text" 
      placeholder="e.g., Acme 3D Printing Co." 
      style="width: 100%; padding: 10px; margin-top: 5px; font-size: 1em;"
    />
    <small style="color: #666; display: block; margin-top: 5px;">This will appear below "Filament Foundry" in the header</small>
    <button onclick="saveBranding()" style="margin-top: 10px;">Save Branding</button>
  </div>

<!-- Low Filament Alert Settings -->
<div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
  <h3>Low Filament Alerts</h3>
  <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
    Set the threshold for low filament warnings. Spools below this amount will be highlighted in yellow. 
    Spools below 50% of this threshold will be highlighted in red.
  </p>
  
  <label for="lowFilamentThreshold">Alert when filament is below (grams):</label>
  <input 
    type="number" 
    id="lowFilamentThreshold" 
    min="10" 
    step="10"
    style="width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc;" 
  />
  
  <button onclick="saveLowFilamentThreshold()" style="width: 100%; padding: 12px; background: #007acc; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer;">
    Save Alert Settings
  </button>
  
  <div style="margin-top: 10px; padding: 10px; background: #f0f4f8; border-radius: 6px; font-size: 0.85em;">
    <strong>Example:</strong> If set to 200g:<br>
    â€¢ ğŸŸ¡ Yellow warning at 200g and below<br>
    â€¢ ğŸ”´ Red critical at 100g and below (50% of threshold)
  </div>
</div>

  <!-- Data Management -->
<div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
  <h3>Data Management</h3>
  
  <p style="margin: 10px 0; color: #666;">Backup your data or restore from a previous backup.</p>
  
  <button onclick="exportUserData()" style="background: #28a745; margin: 5px 0;">
    ğŸ“¥ Export Data (Backup)
  </button>
  
  <button onclick="document.getElementById('importFileInput').click()" style="background: #17a2b8; margin: 5px 0;">
    ğŸ“¤ Import Data (Restore)
  </button>
  
  <input 
    type="file" 
    id="importFileInput" 
    accept=".json" 
    style="display: none;" 
    onchange="importUserData(event)"
  />
  
  <p style="margin-top: 10px; font-size: 0.9em; color: #999;">
    Export creates a backup file. Import restores data from a backup file.
  </p>
</div>

<!-- Contact Developer -->
<div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
  <h3>Support & Privacy</h3>
  
  <p style="margin: 10px 0; color: #666;">Need help or want to delete your data?</p>
  
  <button onclick="contactDeveloper()" style="background: #6c757d; margin: 5px 0;">
    ğŸ“§ Contact Developer
  </button>
  
  <button onclick="requestDataDeletion()" style="background: #dc3545; margin: 5px 0;">
    ğŸ—‘ï¸ Request Data Deletion
  </button>
</div>
  
  <button id="checkUpdatesBtn">Check for Updates</button>
  <button onclick="handleLogout()" style="background: #ff6b6b;">ğŸšª Logout</button>
  <button onclick="showScreen('home')">â¬… Back</button>
</section>

<footer id="footer">
  Â© 2025 DataForge | 
  <a href="https://getdataforge.com" style="color: #a6d1ff; text-decoration: none;">getdataforge.com</a> | 
  <a href="mailto:DataForgeApps@gmail.com" style="color: #a6d1ff; text-decoration: none;">Contact</a>
</footer>

<!-- Empty Spool Modal -->
<div id="emptySpoolModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Manage Empty Spools</h2>
      <button class="modal-close" onclick="closeEmptySpoolModal()">&times;</button>
    </div>
    <div class="modal-body" id="emptySpoolModalBody">
      <!-- Content will be loaded here -->
    </div>
  </div>
</div>

<!-- Create Organization Modal -->
<div id="createOrgModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 500px;">
    <h2>Create Business Account</h2>
    <p style="color: #666; margin-bottom: 20px;">Create a shared workspace for your team to manage inventory and track prints together.</p>
    
    <label for="orgName">Business Name:</label>
    <input type="text" id="orgName" placeholder="e.g., My 3D Printing Shop" style="width: 100%; padding: 10px; margin-bottom: 15px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc;" />
    
    <label for="orgLocation">Your Location/Identifier:</label>
    <input type="text" id="orgLocation" placeholder="e.g., NY Office, Main Workshop" style="width: 100%; padding: 10px; margin-bottom: 20px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc;" />
    <small style="display: block; color: #666; margin-top: -15px; margin-bottom: 20px;">This helps differentiate your inventory from other team members.</small>
    
    <div style="background: #f0f4f8; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
      <strong>Free Business Tier Includes:</strong>
      <ul style="margin: 10px 0; padding-left: 20px;">
        <li>Up to 3 total members (you + 2 others)</li>
        <li>25 spools total across entire team</li>
        <li>100 print jobs in history</li>
        <li>Shared inventory visibility</li>
      </ul>
    </div>
    
    <div style="display: flex; gap: 10px;">
      <button onclick="createOrganization()" style="flex: 1; padding: 12px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer;">Create Business</button>
      <button onclick="closeCreateOrgModal()" style="flex: 1; padding: 12px; background: #666; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer;">Cancel</button>
    </div>
  </div>
</div>

<!-- Join Organization Modal -->
<div id="joinOrgModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 500px;">
    <h2>Join Business Account</h2>
    <p style="color: #666; margin-bottom: 20px;">Enter the invite code provided by your business admin.</p>
    
    <label for="joinInviteCode">Invite Code:</label>
    <input type="text" id="joinInviteCode" placeholder="Enter invite code" style="width: 100%; padding: 10px; margin-bottom: 15px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; text-transform: uppercase;" />
    
    <label for="joinLocation">Your Location/Identifier:</label>
    <input type="text" id="joinLocation" placeholder="e.g., FL Shop, Remote Office" style="width: 100%; padding: 10px; margin-bottom: 20px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc;" />
    
    <div style="display: flex; gap: 10px;">
      <button onclick="joinOrganization()" style="flex: 1; padding: 12px; background: #007acc; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer;">Join Business</button>
      <button onclick="closeJoinOrgModal()" style="flex: 1; padding: 12px; background: #666; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer;">Cancel</button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script src="firebase-config.js"></script>
<script src="home.js"></script>

</body>
</html>