<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filament Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007acc" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Filament Foundry</h1>
    <p style="font-size: 0.85em; margin-top: 5px; opacity: 0.9;">by DataForge</p>
  </header>

<main id="home">
  <button onclick="showScreen('addSpool')">‚ûï Add New Spool</button>
  <button onclick="window.location.href='inventory.html'">üì¶ View Inventory</button>
  <button onclick="window.location.href='emptyspools.html'">üßµ Empty Spool Weights</button>
  <button onclick="showScreen('history')">üìú Usage History</button>
  <button onclick="showScreen('tracking')">üéØ Start Tracking</button>
  <button onclick="showScreen('analytics')">üìä Analytics</button>
  <button onclick="showScreen('settings')">‚öôÔ∏è Settings</button>
</main>

<section id="addSpool" class="hidden">
  <h2>Add New Spool</h2>
  
  <input id="brand" placeholder="Brand" />
  <input id="color" placeholder="Color Name" />
  
  <select id="materialSelect" onchange="handleMaterialChange()" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
    <!-- Options inserted dynamically -->
  </select>
  
  <input
    type="text"
    id="customMaterialInput"
    placeholder="Enter custom material"
    class="hidden"
    style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; margin-bottom: 10px;"
  />
  
  <input id="length" type="number" placeholder="Length (m) - Optional" />

  <!-- NEW: Color Details Section -->
  <div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
    <h3 style="margin-top: 0; font-size: 1.1em;">Color Details</h3>
    
    <label for="colorType" style="display: block; margin-top: 10px; font-weight: bold;">Color Type:</label>
    <select id="colorType" onchange="handleColorTypeChange()" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
      <option value="solid">Solid</option>
      <option value="gradient">Gradient</option>
    </select>
    
    <input 
      id="gradientColors" 
      type="text" 
      placeholder="List gradient colors (e.g., Blue to Purple to Pink)" 
      class="hidden"
      style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; margin-top: 10px;"
    />
    
    <label for="sheen" style="display: block; margin-top: 10px; font-weight: bold;">Sheen:</label>
    <select id="sheen" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
      <option value="">Select...</option>
      <option value="matte">Matte</option>
      <option value="glossy">Glossy</option>
      <option value="silk">Silk</option>
      <option value="glitter">Glitter</option>
      <option value="metallic">Metallic</option>
      <option value="satin">Satin</option>
    </select>
    
    <label style="display: block; margin-top: 15px;">
      <input type="checkbox" id="glowInDark" style="width: auto; margin-right: 8px;" />
      <strong>Glow in the Dark</strong>
    </label>
    
    <label for="texture" style="display: block; margin-top: 10px; font-weight: bold;">Texture:</label>
    <select id="texture" style="padding: 10px; font-size: 1em; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box;">
      <option value="">Select...</option>
      <option value="smooth">Smooth</option>
      <option value="textured">Textured</option>
      <option value="wood-grain">Wood Grain</option>
      <option value="marble">Marble</option>
      <option value="carbon-fiber">Carbon Fiber</option>
      <option value="fuzzy">Fuzzy</option>
    </select>
  </div>

  <!-- Spool Weight Section -->
  <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
    <h3 style="margin-top: 0; font-size: 1.1em;">Spool Weight Information</h3>
    
    <label for="emptySpoolSelect" style="display: block; margin-top: 10px; font-weight: bold;">Empty Spool:</label>
    <select id="emptySpoolSelect" onchange="handleEmptySpoolSelection()"></select>

    <input 
      id="fullSpoolWeight" 
      type="number" 
      step="0.01" 
      placeholder="Full spool weight (including empty spool) (g)" 
      oninput="calculateFilamentAmount()"
      style="margin-top: 10px;"
    />

    <div id="filamentAmountDisplay" style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px; display: none;">
      <strong>Calculated Filament Amount:</strong>
      <div style="font-size: 1.3em; color: #007acc; font-weight: bold; margin-top: 5px;" id="filamentAmount">0g</div>
    </div>
  </div>
  
  <div class="button-container">
    <button onclick="saveSpool()">Save Spool</button>
    <button type="button" onclick="window.location.href='emptyspools.html'">Manage Empty Spools</button>
    <button onclick="showScreen('home')">‚¨Ö Back</button>
  </div>
</section>

<!-- Inventory Screen -->
<section id="library" class="hidden">
  <h2>Spool Library</h2>
  <ul id="spoolList"></ul>
  <button onclick="showScreen('home')">‚¨Ö Back</button>
</section>

<section id="history" class="hidden">
  <h2>Usage History</h2>

  <div id="historyFilters" style="margin-bottom: 15px;">
    <label>
      Start Date:
      <input type="date" id="filterStartDate" />
    </label>

    <label style="margin-left: 10px;">
      End Date:
      <input type="date" id="filterEndDate" />
    </label>

    <label style="margin-left: 10px;">
      Spool:
      <select id="filterSpool">
        <option value="">All Spools</option>
        <!-- Options populated dynamically -->
      </select>
    </label>

    <button id="filterButton" style="margin-left: 10px;">Filter</button>
    <button id="clearFilterButton" style="margin-left: 5px;">Clear</button>
  </div>

  <ul id="historyList"></ul>
  <button onclick="showScreen('home')">‚¨Ö Back</button>
</section>

<!-- Tracking / Print Jobs Screen -->
<section id="tracking" class="hidden">
  <h2>Print Job Tracking</h2>

  <!-- Start Print Form -->
  <section id="startPrintSection">
    <h2>Start Print Job</h2>
    <input id="jobName" placeholder="Enter print job name (optional)" />
    <label for="selectSpools">Select Spools (multi-select):</label>
    <select id="selectSpools" multiple size="5" style="width: 100%;"></select>
    
    <!-- NEW: Estimated weight fields will appear here per spool -->
    <div id="estimatedWeightsContainer"></div>
    
    <div class="button-container">
      <button onclick="startPrintJob()">Start Print</button>
      <button onclick="showScreen('home')">‚¨Ö Back</button>
    </div>
  </section>

  <section id="endPrintSection" class="hidden">
    <h3 id="activeJobName"></h3>
    <div id="endWeightsContainer"></div>
    
    <div class="button-container">
      <button onclick="endPrintJob()">‚úÖ End Print (Success)</button>
      <button onclick="failedPrintJob()" style="background: #ff6b6b;">‚ùå Failed Print</button>
      <button onclick="cancelActiveJob()">Cancel Job</button>
      <button onclick="showScreen('home')">‚¨Ö Back</button>
    </div>
  </section>
</section>

<!-- Analytics screen -->
<section id="analytics" class="hidden" style="height:400px; position:relative;">
  <h2>Analytics</h2>
  <canvas id="usageChart"></canvas>
  <button onclick="showScreen('home')">‚¨Ö Back</button>
</section>

<!-- Settings Screen -->
<section id="settings" class="hidden">
  <h2>Settings</h2>
  
  <!-- Material Management -->
  <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 8px;">
    <h3>Manage Material Types</h3>
    <ul id="materialsList" style="list-style: none; padding: 0;"></ul>
    
    <div style="margin-top: 15px;">
      <input id="newMaterialInput" placeholder="Add new material type" style="width: 70%; display: inline-block;" />
      <button onclick="addNewMaterial()" style="width: 25%; display: inline-block; margin-left: 3%;">Add</button>
    </div>
  </div>
  
  <button id="checkUpdatesBtn">Check for Updates</button>
  <button onclick="showScreen('home')">‚¨Ö Back</button>
</section>

<footer id="footer">
  ¬© 2025 DataForge | 
  <a href="https://getdataforge.com" style="color: #a6d1ff; text-decoration: none;">getdataforge.com</a> | 
  <a href="mailto:DataForgeApps@gmail.com" style="color: #a6d1ff; text-decoration: none;">Contact</a>
</footer>

<script src="home.js"></script>
</body>
</html>